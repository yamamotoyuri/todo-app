# 基本設計書

---

## プロジェクト概要

このプロジェクトは、**タスク管理アプリケーション**。ユーザーはタスクを作成、管理、削除することができる。

---

## 技術スタック

| 分類           | 技術 / バージョン    |
| -------------- | -------------------- |
| バックエンド   | PHP 8.4 / Laravel 12 |
| フロントエンド | React 18 / Vite      |
| データベース   | MySQL 8.4 (LTS)      |

## 主要なディレクトリ構成

```text
todo-app/
├── docker-compose.yml     # 全コンテナの実行定義
├── backend/               # Laravel プロジェクト（APIサーバー）
│   ├── app/               # 核心ロジック (Services/Repositoriesを追加)
│   ├── database/migrations/ # テーブル定義
│   ├── Dockerfile         # Backend用ビルド定義
│   └── .env               # Laravel用環境設定
└── frontend/              # React プロジェクト（UI）
    ├── src/               # React ソースコード
    │   ├── components/    # UI部品
    │   └── App.jsx        # メインコード
    ├── Dockerfile         # Frontend用ビルド定義
    └── vite.config.js     # Viteの設定
```

## 環境構築

### セットアップ手順

1. **プロジェクトの土台作成**

```bash
   # 任意の作業ディレクトリを作成
   mkdir todo-app
   cd todo-app

   # 必要なディレクトリを作成
   mkdir backend frontend
```

2. **Docker Composeの設定**
   プロジェクトルートに docker-compose.yml を作成し、PHP 8.4とNode.jsの実行環境を定義する

   ```bash
   # コンテナの起動（まだ中身は空の状態）
   docker compose up -d --build

   # コンテナ内で Laravel 12 をインストール
   docker compose exec backend composer create-project laravel/laravel .
   ```

3. **Laravel (Backend) のインストール**
   コンテナを起動し、その中でLaravelプロジェクトを生成する

   ```bash
   docker compose exec backend php artisan serve --host=0.0.0.0 --port=8000
   ```

4. **React (Frontend) のインストール**
   　　フロントエンドコンテナ内で、Viteを使用してReactプロジェクトを構成する

   ```bash
    # ViteによるReactテンプレートの生成
   docker compose exec frontend npm create vite@latest . -- --template react

   # 依存パッケージのインストール
   docker compose exec frontend npm install
   ```

5. **API疎通とCORSの初期設定**

   ```bash
   # API機能の有効化
   docker compose exec backend php artisan install:api
   ```

   backend/.env をエディタで開き、以下の2行を確実に設定する。これにより、環境依存のトラブルを防ぐ

   | 設定項目             | 値                    | 役割                           |
   | -------------------- | --------------------- | ------------------------------ |
   | SERVER_HOST          | 0.0.0.0               | コンテナ外からの通信を許可する |
   | CORS_ALLOWED_ORIGINS | http://localhost:5174 | Reactからのアクセスを許可      |

---

## データベース

### テーブル一覧

#### tasks テーブル

タスク情報を管理するメインテーブル

| カラム名     | 型          | 説明                            |
| ------------ | ----------- | ------------------------------- |
| id           | bigint      | 主キー（自動採番）              |
| title        | string(255) | タスクのタイトル                |
| is_completed | boolean     | 完了フラグ（デフォルト: false） |
| created_at   | timestamp   | 作成日時                        |
| updated_at   | timestamp   | 更新日時                        |

#### sessions テーブル

セッション情報を管理するテーブル

| カラム名      | 型         | 説明                                   |
| ------------- | ---------- | -------------------------------------- |
| id            | string     | セッションID（主キー）                 |
| user_id       | bigint     | ユーザーID（null許可）                 |
| ip_address    | string(45) | IPアドレス                             |
| user_agent    | text       | ユーザーエージェント                   |
| payload       | longtext   | セッションデータ                       |
| last_activity | integer    | 最終アクティビティのUNIXタイムスタンプ |

#### personal_access_tokens テーブル

APIアクセストークンを管理するテーブル

| カラム名       | 型         | 説明                   |
| -------------- | ---------- | ---------------------- |
| id             | bigint     | 主キー（自動採番）     |
| tokenable_type | string     | トークン所有者の型     |
| tokenable_id   | bigint     | トークン所有者のID     |
| name           | text       | トークン名             |
| token          | string(64) | トークン値（ユニーク） |
| abilities      | text       | トークンの権限         |
| last_used_at   | timestamp  | 最終使用日時           |
| expires_at     | timestamp  | 有効期限               |
| created_at     | timestamp  | 作成日時               |
| updated_at     | timestamp  | 更新日時               |

---

## 機能一覧

| 機能名             | 説明                              |
| ------------------ | --------------------------------- |
| タスク作成         | 新しいタスクの追加                |
| タスク一覧表示     | 全タスクを一覧表示                |
| タスク編集         | 既存タスクの更新                  |
| タスク削除         | タスクの削除                      |
| タスク状態管理     | タスクの完了/未完了状態を切り替え |
| データエクスポート | タスクデータのエクスポート        |

---
